"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=e(require("zustand")),o=require("three"),i=e(require("fast-deep-equal")),a=e(require("zustand/shallow")),s=e(require("react-merge-refs"));function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function f(e,t,r){return(f=c()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&u(o,r.prototype),o}).apply(null,arguments)}function p(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t.indexOf(r=i[n])>=0||(o[r]=e[r]);return o}function d(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var m=n((function(e,t){return setTimeout((function(){var t=o.DefaultLoadingManager.onProgress;o.DefaultLoadingManager.onProgress=function(r,n,o){t(r,n,o),r.match(/\.hdr$/)&&e((function(e){var t=new Set(e.hdrPaths);return t.add(r),{hdrPaths:Array.from(t)}}))}})),{scene:null,gl:null,allowImplicitInstancing:!1,orbitControlsRef:null,editables:{},canvasName:"default",initialState:null,selected:null,transformControlsMode:"translate",transformControlsSpace:"world",viewportShading:"rendered",editorOpen:!1,sceneSnapshot:null,editablesSnapshot:null,hdrPaths:[],selectedHdr:null,showOverlayIcons:!1,useHdrAsBackground:!0,showGrid:!0,showAxes:!0,init:function(r,n,i,a){var s=t().editables,l=a?Object.fromEntries(Object.entries(a.editables).map((function(e){var t,r,n=e[0],i=e[1],a=s[n];return[n,{type:i.type,role:null!=(t=null==a?void 0:a.role)?t:"removed",properties:{transform:(new o.Matrix4).fromArray(i.properties.transform)},initialProperties:null!=(r=null==a?void 0:a.initialProperties)?r:{transform:new o.Matrix4}}]}))):s;e({scene:r,gl:n,allowImplicitInstancing:i,editables:l,initialState:a})},addEditable:function(t,r,n){return e((function(e){var o,i=n;if(e.editables[r]){if("active"===e.editables[r].role&&!e.allowImplicitInstancing)throw Error("Scene already has an editable object named "+r+".\n  If this is intentional, please set the allowImplicitInstancing prop of EditableManager to true.");i=e.editables[r].properties}return{editables:l({},e.editables,(o={},o[r]={type:t,role:"active",properties:i,initialProperties:n},o))}}))},setOrbitControlsRef:function(t){e({orbitControlsRef:t})},removeEditable:function(t){return e((function(e){var r,n=e.editables,o=n[t];return{editables:l({},p(n,[t].map(d)),(r={},r[t]=l({},o,{role:"removed"}),r))}}))},setEditableTransform:function(t,r){e((function(e){var n;return{editables:l({},e.editables,(n={},n[t]=l({},e.editables[t],{properties:{transform:r}}),n))}}))},setSelected:function(t){e({selected:t})},setSelectedHdr:function(t){e({selectedHdr:t})},setTransformControlsMode:function(t){e({transformControlsMode:t})},setTransformControlsSpace:function(t){e({transformControlsSpace:t})},setViewportShading:function(t){e({viewportShading:t})},setShowOverlayIcons:function(t){e({showOverlayIcons:t})},setUseHdrAsBackground:function(t){e({useHdrAsBackground:t})},setShowGrid:function(t){e({showGrid:t})},setShowAxes:function(t){e({showAxes:t})},setEditorOpen:function(t){e({editorOpen:t})},createSnapshot:function(){e((function(e){var t;return{sceneSnapshot:null==(t=e.scene)?void 0:t.clone(),editablesSnapshot:e.editables}}))},setSnapshotProxyObject:function(t,r){e((function(e){var n;return{editablesSnapshot:l({},e.editablesSnapshot,(n={},n[r]=l({},e.editablesSnapshot[r],{proxyObject:t}),n))}}))},serialize:function(){return{editables:Object.fromEntries(Object.entries(t().editables).map((function(e){var t=e[1];return[e[0],{type:t.type,properties:{transform:t.properties.transform.toArray()}}]})))}},isPersistedStateDifferentThanInitial:function(){var e=t().initialState,r=t().canvasName;return!(!e||!b||i(b.canvases[r],e))},applyPersistedState:function(){var r=t().editables,n=t().canvasName;if(b){var i=Object.fromEntries(Object.entries(b.canvases[n].editables).map((function(e){var t,n,i=e[0],a=e[1],s=r[i];return[i,{type:a.type,role:null!=(t=null==s?void 0:s.role)?t:"removed",properties:{transform:(new o.Matrix4).fromArray(a.properties.transform)},initialProperties:null!=(n=null==s?void 0:s.initialProperties)?n:{transform:new o.Matrix4}}]})));e({editables:i})}}}})),v=function(e){return[null,void 0]}(),b=v[0],h=v[1],y=function(e,n){return t.forwardRef((function(i,l){var u=i.uniqueName,c=i.position,d=i.rotation,v=i.scale,b=p(i,["uniqueName","position","rotation","scale"]),h=t.useRef(),y=m((function(e){return[e.addEditable,e.removeEditable]}),a),g=y[0],w=y[1],S=[];return["x","y","z"].forEach((function(e){S.push(b["position-"+e],b["rotation-"+e],b["scale-"+e])})),t.useLayoutEffect((function(){var e=c?f(o.Vector3,c):new o.Vector3,t=d?f(o.Vector3,d):new o.Vector3,r=v?f(o.Vector3,v):new o.Vector3(1,1,1);["x","y","z"].forEach((function(n,o){b["position-"+n]&&e.setComponent(o,b["position-"+n]),b["rotation-"+n]&&t.setComponent(o,b["rotation-"+n]),b["scale-"+n]&&r.setComponent(o,b["scale-"+n])}));var i=(new o.Quaternion).setFromEuler((new o.Euler).setFromVector3(t));return g(n,u,{transform:(new o.Matrix4).compose(e,i,r)}),function(){w(u)}}),[g,c,w,d,v,u].concat(S)),t.useLayoutEffect((function(){var e=h.current;m.getState().editables[u].properties.transform.decompose(e.position,e.quaternion,e.scale);var t=m.subscribe((function(t){t&&m.getState().editables[u].properties.transform.decompose(e.position,e.quaternion,e.scale)}),(function(e){return e.editables[u].properties.transform}));return function(){t()}}),[u]),r.createElement(e,Object.assign({ref:s([h,l])},b,{userData:{__editable:!0,__editableName:u,__editableType:n}}))}))},g=function(e){return y(e,e)};y.group=g("group"),y.mesh=g("mesh"),y.spotLight=g("spotLight"),y.directionalLight=g("directionalLight"),y.pointLight=g("pointLight"),y.perspectiveCamera=g("perspectiveCamera"),y.orthographicCamera=g("orthographicCamera"),exports.configure=function(e){var t=(void 0===e?{}:e).enablePersistence,r=void 0===t||t;if(h&&h(),r){var n=[null,void 0];b=n[0],h=n[1]}else b=null,h=void 0;return function(e){var t=void 0===e?{}:e,r=t.allowImplicitInstancing,n=void 0!==r&&r,o=t.state;return function(e){var t=e.gl,r=e.scene;(0,m.getState().init)(r,t,n,o)}}},exports.editable=y;
//# sourceMappingURL=react-three-editable.cjs.production.min.js.map
